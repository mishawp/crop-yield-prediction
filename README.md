# Прогнозирование урожайности сельскохозяйственных культур

## Структура проекта

\* - данных нет в репозитории github и нужны только для отчетов.

```plaintext
├── data/                                       <- Корневая директория для всех данных проекта
│   │
│   ├── external/                               <- Внешние данные, не изменяемые в рамках проекта (например, справочники)
│   │   │
│   │   └── state_and_county_fips_master.csv    <- Мастер-файл с кодами FIPS штатов и округов
│   │
│   ├── interim/                                <- Промежуточные данные, полученные в процессе обработки
│   │
│   ├── processed/                              <- Окончательные обработанные данные, готовые для обучения
│   │
│   └── raw/                                    <- Исходные сырые данные (не изменяются)
│       │
│       ├── ERA5-Land-Moisture/                 <- Данные о влажности почвы из ERA5-Land
│       │
│       ├── Sentinel/                           <- Данные спутника Sentinel
│       │
│       ├── USDA/                               <- Исторические данные об урожайности США
│       │
│       └── WRF-HRRR/                           <- Метеорологические данные модели WRF-HRRR
|
├── mlflow/                                     <- Директория для MLflow
|   |
│   ├── postgres_data                           <- PostgreSQL для хранения экспериментов (артефакты в S3)
│   │
│   ├── Dockerfile                              <- конфигурация Docker для развертывания MLflow-сервера
│   │
│   └── requirements.txt                        <- Зависимости Python для работы MLflow
│
├── notebooks/                                  <- Jupyter notebooks для анализа и визуализации
│   │
│   ├── 1.1-data-review-sentinel.ipynb          <- Обзор и предварительный анализ данных Sentinel
│   │
│   ├── 1.2-data-review-usda.ipynb              <- Обзор данных USDA
│   │
│   ├── 1.3-data-review-wrf-hrrr.ipynb          <- Анализ метеорологических данных
│   │
│   ├── 1.4-data-review-moisture.ipynb          <- Анализ данных о влажности почвы
│   │
│   └── 2.0-EDA.ipynb                           <- Notebook для разведочного анализа данных (EDA)
│
├── obsidian/                                   <- Заметки в формате Obsidian
│
├── resources/                                  <- * Ресурсы проекта (изображения, карты и т.д.)
│   │
│   └── USA-map/                                <- Географические данные по США
│
├── src/                                        <- Исходный код проекта
│   │
│   ├── data/                                   <- Скрипты для работы с данными
│   │   │
│   │   ├── dataset.py                          <- torch Dataset
│   │   │
│   │   ├── download.py                         <- Скрипты для загрузки данных
│   │   │
│   │   ├── ERA5_nc_to_csv.ipynb                <- Конвертация данных ERA5 из netCDF в CSV
│   │   │
│   │   ├── integration.py                      <- Интеграция данных из разных источников
│   │   │
│   │   ├── process.ipynb                       <- Предобработка данных после интеграции
│   │   │
│   │   └── process.ipynb                       <- Описание пайплайна всей предобработки данных
|   |
│   ├── model/                                  <- Скрипты для работы с моделями
│   │   │
│   │   ├── gru.py                              <- Класс GRURegressor
│   │   │
│   │   └── train.py                            <- Обучение и тестирование модели
│
├── .dvcignore                                  <- Файл исключений для DVC (аналог .gitignore)
│
├── .gitignore                                  <- Файл исключений для Git
│
├── data.dvc                                    <- Файл конфигурации DVC для управления данными
│
├── dvc.lock                                    <- Файл блокировки DVC (аналог package-lock.json)
│
├── dvc.yaml                                    <- Конфигурация pipelines DVC
│
├── README.md                                   <- Основная документация проекта
│
├── docker-compose.yaml                         <- docker-compose.yaml
|
├── requirements.txt                            <- Зависимости Python
│
└── .env                                        <- Переменные окружения (чувствительные данные)
```

## Постановка задачи

Если не обобщать, то задача следующая:
Прогнозирование урожайности *кукурузы* (бушель/акр) *региона* (в частности регионов штатов IL, IA, IN, KY, MO, OH) на основе данных периода с *ноябрь предыдущего года - август текущего года*.

*Октябрь - Сентябрь* - время сбора урожая.

## Воспроизведение пайплайна

- `dvc pull data`
- `dvc repro`

## Навигация по проекту

### 1. Описание данных

- [спутниковые снимки Sentinel](notebooks/1.1-data-review-sentinel.ipynb);
- [исторические данные об урожайности](notebooks/1.2-data-review-usda.ipynb);
- [климатические данные](notebooks/1.3-data-review-wrf-hrrr.ipynb);
- [данные о влажности почвы](notebooks/1.4-data-review-moisture.ipynb).

### 2. Интеграция данных

Соединение датасетов воедино

- [Интеграция данных](/src/data/integration.py).

### 3. Исследовательский анализ данных

Анализ данных, полученных после *интеграции*

- [EDA](notebooks/2.0-EDA.ipynb)

### 4. Предобработка данных

- [Data Processing](src/data/process.py)
- [torch Dataset](src/data/dataset.py)

### 5. Обучение и тестирование

- [GRU](src/model/gru.py)
- [Обучение и тестирование моделей](src/model/train.py)

## Результаты

| Metric | Value |
| ------ | ----- |
| $R^2$  | 0.112 |
| RMSE   | 27.73 |
