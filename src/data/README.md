# Обработка данных

## 1. Интеграция данных

### Корректировки под baseline:

- Снимки Sentinel **не используются**. Только табличные данные.

### Имеющиеся данные

1. [Спутниковые снимки Sentinel](../../notebooks/1.1-data-review-sentinel.ipynb);
2. [Климатические данные](../../notebooks/1.3-data-review-wrf-hrrr.ipynb);
3. [Данные о влажности почвы](../../notebooks/1.4-data-review-moisture.ipynb);
4. [Исторические данные об урожайности](../../notebooks/1.2-data-review-usda.ipynb).

**Необходимо** объединить их в единое целое.

### Структура будущего датасета

```plaintext
interim
    |
    ├── X.csv                               # Табличные данные. Признаки
    |
    ├── y.csv                               # Таргетные значения
    |
    └── images/
        ├── <fips>-<year>-<month>-<day>     # Набор снимков для одного округа и даты
        |   ├── 1.npy
        |   ├── 2.npy
        |   └── ...
        |
        └── ...                             # Остальные наборы снимков
```

### Шаги интеграции

1. Возьмем данные *за 1 и 15 дни* каждого месяца
2. Удалим метаданные из таблиц
3. Усредним данные для каждого округа (fips)
4. Таргетной переменной является `YIELD, MEASURED IN BU / ACRE` из таблицы *USDA*. `PRODUCTION, MEASURED IN BU` удаляем
5. Соединяем *WRF-HRRR* с *ERA5* по дате и fips. Полученный DataFrame обозначим через *X*
6. Добавляем в *X* столбец `images` - пути к изображениям *Sentinel*
7. Копируем изображения в формате, как показано в [структуре будущего проекта](#структура-будущего-датасета)
8. Сортируем по year, fips, month, day
9. Сохраняем *X* как `data/interim/X.csv` и данные *USDA* как `data/interim/y.csv`